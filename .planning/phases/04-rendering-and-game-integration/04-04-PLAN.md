---
phase: 04-rendering-and-game-integration
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - Berzerk/Content/Models/test-character.fbx
autonomous: false
gap_closure: true

must_haves:
  truths:
    - "test-character.fbx and animation FBX files share the same bind pose/T-pose from Mixamo"
    - "Character limbs do not stretch or distort during animation playback"
    - "Content pipeline builds all 5 FBX files with matching 65-bone skeleton"
  artifacts:
    - path: "Berzerk/Content/Models/test-character.fbx"
      provides: "Base character model with bind pose matching Phase 3 animation files"
  key_links:
    - from: "Berzerk/Content/Models/test-character.fbx"
      to: "Animation FBX files (idle, walk, run, bash)"
      via: "Shared bind pose enables AddAnimationsFrom to merge clips without distortion"
      pattern: "AddAnimationsFrom"
---

<objective>
Fix bind pose mismatch between test-character.fbx and the animation FBX files, which causes severe leg stretching/distortion during animation.

Purpose: test-character.fbx was downloaded from Mixamo at a different time than the animation files (idle/walk/run/bash), which were re-downloaded in Phase 3. Different Mixamo download sessions can produce different T-pose/bind pose configurations for the same character. When AddAnimationsFrom merges animation clips from one bind pose onto a skeleton with a different bind pose, the inverse bind pose multiplication produces incorrect skinning matrices, resulting in stretched/distorted vertices -- especially visible in the legs.

Output: A fresh test-character.fbx downloaded from the same Mixamo character used for the Phase 3 animation files, producing matching bind poses across all FBX assets.
</objective>

<execution_context>
@/Users/rui/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rui/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-rendering-and-game-integration/04-VERIFICATION.md
@.planning/phases/03-animation-runtime/03-01-SUMMARY.md
@Berzerk/Content/Content.mgcb
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Re-download test-character.fbx from Mixamo with matching bind pose</name>
  <action>
The user must re-download the base character model from Mixamo to ensure its bind pose matches the animation files downloaded in Phase 3.

**Instructions for the user:**

1. Go to https://www.mixamo.com/
2. Select the SAME character that was used for the Phase 3 animation downloads (idle, walk, run, bash). This is critical -- the character model must be identical.
3. Download the character in T-pose (no animation selected):
   - Format: **FBX Binary (.fbx)**
   - Pose: **T-pose** (the default when no animation is selected)
   - Click "Download" without selecting any animation
4. Save/replace the downloaded file as: `Berzerk/Content/Models/test-character.fbx`

**Critical details:**
- The character MUST be the same one used for the Phase 3 animation downloads. If you used a different Mixamo character or cannot recall, re-download ALL files (character + idle + walk + run + bash) from the same character in one session.
- Do NOT select "With Skin" for the T-pose download -- that option is for animation files. For the base character, just download the default T-pose.
- If Mixamo offers format options like "FBX 7.4" vs "FBX 2013", use the same format as the Phase 3 downloads.
  </action>
  <resume-signal>Type "downloaded" when test-character.fbx has been replaced, or describe any issues</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Rebuild content pipeline and verify bone consistency</name>
  <files>Berzerk/Content/Models/test-character.fbx</files>
  <action>
After the user has replaced test-character.fbx:

**1. Clean content build artifacts:**
Delete the intermediate and output directories to force a full rebuild:
```bash
rm -rf Berzerk/Content/bin/ Berzerk/Content/obj/
```

**2. Rebuild the full project (which triggers content pipeline):**
```bash
dotnet build Berzerk/Berzerk.csproj
```

**3. Verify bone count consistency:**
Run the game briefly (or use build output) to confirm that test-character.fbx still produces 65 bones matching the animation files. The console output from AnimatedModel.LoadContent should show the bone count.

If the build fails or bone counts don't match:
- If the new test-character.fbx produces a different bone count than 65, it means a different Mixamo character was used. The user needs to re-download using the correct character.
- If the build fails with content pipeline errors, check that the FBX file is valid and the MixamoModelProcessor can process it.

**4. Verify the game launches and character renders without distortion:**
Launch the game briefly. The character's legs should NOT be stretched or distorted during animation. If distortion persists, the bind poses still don't match and all FBX files need to be re-downloaded from Mixamo in one session.

**What NOT to do:**
- Do NOT modify any C# source files in this task
- Do NOT modify Content.mgcb (the pipeline config is already correct)
- Do NOT change the MixamoModelProcessor
  </action>
  <verify>
1. `dotnet build Berzerk/Berzerk.csproj` compiles with zero errors and zero warnings from content pipeline.
2. Content build output shows test-character.fbx processed successfully by MixamoModelProcessor.
3. The game launches without crashes.
4. Console output confirms 65 bones for test-character model (matching animation files).
  </verify>
  <done>
test-character.fbx has been replaced with a version whose bind pose matches the Phase 3 animation files. Content pipeline rebuilds successfully with 65 bones. The character does not exhibit leg stretching or distortion during animation playback.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build Berzerk/Berzerk.csproj` compiles with zero errors
2. test-character.fbx produces 65-bone SkinningData matching animation files
3. Game launches and character renders without leg stretching/distortion
4. All 5 FBX files (test-character, idle, walk, run, bash) process through MixamoModelProcessor successfully
</verification>

<success_criteria>
- test-character.fbx bind pose matches animation FBX file bind poses
- Content pipeline builds all 5 FBX files with consistent 65-bone skeletons
- Character renders without limb stretching or distortion during animation
- No content pipeline errors or warnings
</success_criteria>

<output>
After completion, create `.planning/phases/04-rendering-and-game-integration/04-04-SUMMARY.md`
</output>
