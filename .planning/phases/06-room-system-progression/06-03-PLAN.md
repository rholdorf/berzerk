---
phase: 06-room-system-progression
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - Berzerk/Source/Rooms/RoomRenderer.cs
  - Berzerk/Source/Graphics/DebugRenderer.cs
autonomous: true

must_haves:
  truths:
    - "Doors render with color indicating state (red=closed, yellow=opening, green=open)"
    - "Room walls render using existing DebugRenderer pattern"
    - "Door trigger volumes can be visualized for debugging"
  artifacts:
    - path: "Berzerk/Source/Rooms/RoomRenderer.cs"
      provides: "Visual rendering for room doors and walls"
      contains: "class RoomRenderer"
    - path: "Berzerk/Source/Graphics/DebugRenderer.cs"
      provides: "Extended DrawDoor method for door state visualization"
      contains: "DrawDoor"
  key_links:
    - from: "Berzerk/Source/Rooms/RoomRenderer.cs"
      to: "Berzerk/Source/Graphics/DebugRenderer.cs"
      via: "DrawBoundingBoxes and DrawDoor calls"
      pattern: "_debugRenderer\\.Draw"
    - from: "Berzerk/Source/Rooms/RoomRenderer.cs"
      to: "Berzerk/Source/Rooms/Room.cs"
      via: "Room.Walls and Room.Doors access"
      pattern: "room\\.Walls|room\\.Doors"
---

<objective>
Create RoomRenderer for visual representation of room geometry and doors with state-based coloring.

Purpose: Provide visual feedback for room state - players need to see which doors are open/closed. Uses existing DebugRenderer pattern for consistency.
Output: RoomRenderer class and extended DebugRenderer for door visualization.
</objective>

<execution_context>
@/Users/rui/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rui/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-room-system-progression/06-RESEARCH.md
@Berzerk/Source/Graphics/DebugRenderer.cs

Key patterns from research:
- Door color coding: Red=Closed, Yellow=Opening, Green=Open (clear visual feedback)
- Use existing DebugRenderer.DrawBoundingBoxes for walls
- Door visual can be collision box (when closed) or frame outline (when open)

Existing DebugRenderer patterns:
- DrawBoundingBoxes takes List<BoundingBox>, view, projection, color
- Uses BasicEffect with VertexPositionColor for wireframe rendering
- DrawFloor, DrawTargets, DrawPickups all follow same pattern
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add door drawing method to DebugRenderer</name>
  <files>Berzerk/Source/Graphics/DebugRenderer.cs</files>
  <action>
Add a DrawDoor method to DebugRenderer that renders a door with state-based coloring:

Find the existing DebugRenderer class and add this method after the existing Draw methods:

```csharp
/// <summary>
/// Draw a single door with color based on state.
/// Red = Closed, Yellow = Opening, Green = Open.
/// </summary>
public void DrawDoor(Door door, Matrix view, Matrix projection)
{
    Color doorColor = door.State switch
    {
        DoorState.Closed => Color.Red,
        DoorState.Opening => Color.Yellow,
        DoorState.Open => Color.Green,
        _ => Color.White
    };

    // Draw the collision box area (shows door frame)
    DrawBoundingBox(door.CollisionBox, view, projection, doorColor);
}

/// <summary>
/// Draw door trigger volume for debugging (semi-transparent).
/// </summary>
public void DrawDoorTrigger(Door door, Matrix view, Matrix projection)
{
    // Draw trigger volume in cyan for visibility
    DrawBoundingBox(door.TriggerVolume, view, projection, Color.Cyan * 0.5f);
}

/// <summary>
/// Draw a single bounding box wireframe.
/// </summary>
public void DrawBoundingBox(BoundingBox box, Matrix view, Matrix projection, Color color)
{
    DrawBoundingBoxes(new List<BoundingBox> { box }, view, projection, color);
}
```

Also add the required using statement at the top if not present:
```csharp
using Berzerk.Source.Rooms;
```
  </action>
  <verify>File compiles without errors: `dotnet build Berzerk/Berzerk.csproj`</verify>
  <done>DebugRenderer has DrawDoor method with state-based coloring (Red/Yellow/Green), DrawDoorTrigger for debug visualization, and single-box DrawBoundingBox helper</done>
</task>

<task type="auto">
  <name>Task 2: Create RoomRenderer class</name>
  <files>Berzerk/Source/Rooms/RoomRenderer.cs</files>
  <action>
Create RoomRenderer class that draws room walls and doors:

```csharp
using Microsoft.Xna.Framework;
using Microsoft.Xna.Framework.Graphics;
using Berzerk.Source.Graphics;

namespace Berzerk.Source.Rooms;

/// <summary>
/// Renders room geometry: walls and doors with state-based coloring.
/// Uses DebugRenderer for consistent wireframe rendering.
/// </summary>
public class RoomRenderer
{
    private DebugRenderer _debugRenderer;
    private bool _showTriggers = false;  // Toggle for debug visualization

    public RoomRenderer(GraphicsDevice graphicsDevice)
    {
        _debugRenderer = new DebugRenderer(graphicsDevice);
    }

    /// <summary>
    /// Toggle trigger volume visualization for debugging.
    /// </summary>
    public bool ShowTriggers
    {
        get => _showTriggers;
        set => _showTriggers = value;
    }

    /// <summary>
    /// Draw complete room: walls and doors.
    /// </summary>
    public void Draw(Room room, Matrix view, Matrix projection)
    {
        // Draw walls in white (matches existing test wall rendering)
        _debugRenderer.DrawBoundingBoxes(room.Walls, view, projection, Color.White);

        // Draw each door with state-based color
        foreach (var door in room.Doors.Values)
        {
            _debugRenderer.DrawDoor(door, view, projection);

            // Optionally draw trigger volumes for debugging
            if (_showTriggers)
            {
                _debugRenderer.DrawDoorTrigger(door, view, projection);
            }
        }
    }

    /// <summary>
    /// Draw floor grid for room.
    /// </summary>
    public void DrawFloor(Matrix view, Matrix projection)
    {
        _debugRenderer.DrawFloor(view, projection);
    }
}
```
  </action>
  <verify>File compiles without errors: `dotnet build Berzerk/Berzerk.csproj`</verify>
  <done>RoomRenderer draws room walls in white and doors with state-based coloring; supports trigger visualization toggle for debugging</done>
</task>

</tasks>

<verification>
All verification in single command:
```bash
dotnet build Berzerk/Berzerk.csproj && echo "BUILD SUCCESS - Room rendering compiles"
```

Expected: BUILD SUCCESS with no errors. Files:
- Berzerk/Source/Rooms/RoomRenderer.cs exists with Draw method
- Berzerk/Source/Graphics/DebugRenderer.cs has DrawDoor, DrawDoorTrigger, DrawBoundingBox methods
</verification>

<success_criteria>
1. RoomRenderer.cs created in Berzerk/Source/Rooms/
2. DebugRenderer.cs extended with DrawDoor method
3. Project compiles without errors
4. DrawDoor uses Red/Yellow/Green for Closed/Opening/Open states
5. RoomRenderer.Draw() renders walls then doors
6. ShowTriggers property enables debug trigger volume visualization
</success_criteria>

<output>
After completion, create `.planning/phases/06-room-system-progression/06-03-SUMMARY.md`
</output>
