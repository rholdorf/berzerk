---
phase: 07-ui-hud
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Berzerk/Source/Combat/ScoreSystem.cs
  - Berzerk/Source/UI/AmmoCounter.cs
  - Berzerk/Source/UI/ScoreCounter.cs
  - Berzerk/Source/UI/PickupNotification.cs
autonomous: true

must_haves:
  truths:
    - "ScoreSystem tracks points and fires events on score change"
    - "AmmoCounter renders magazine/reserve count at top-right with low ammo flash"
    - "ScoreCounter renders score centered at top of screen"
    - "PickupNotification shows timed popup text that fades out"
  artifacts:
    - path: "Berzerk/Source/Combat/ScoreSystem.cs"
      provides: "Point tracking with event-based score changes"
      exports: ["ScoreSystem"]
    - path: "Berzerk/Source/UI/AmmoCounter.cs"
      provides: "Top-right ammo display with low ammo warning flash"
      exports: ["AmmoCounter"]
    - path: "Berzerk/Source/UI/ScoreCounter.cs"
      provides: "Top-center score display"
      exports: ["ScoreCounter"]
    - path: "Berzerk/Source/UI/PickupNotification.cs"
      provides: "Temporary stacking notification popups with fade-out"
      exports: ["PickupNotification"]
  key_links:
    - from: "Berzerk/Source/UI/AmmoCounter.cs"
      to: "AmmoSystem"
      via: "Draw method receives currentMag and reserveAmmo parameters"
      pattern: "Draw.*int currentMag.*int reserveAmmo"
    - from: "Berzerk/Source/UI/ScoreCounter.cs"
      to: "ScoreSystem"
      via: "Draw method receives score parameter"
      pattern: "Draw.*int score"
---

<objective>
Create score tracking system and HUD display elements for ammo, score, and pickup notifications.

Purpose: Implement the data and display components that Phase 7 integration (Plan 03) will wire into BerzerkGame. These are independent UI elements following established project patterns (SpriteFont text rendering, programmatic textures, exponential decay).

Output: Four new files - ScoreSystem for point tracking, AmmoCounter for top-right ammo display, ScoreCounter for top-center score display, PickupNotification for temporary popup text.
</objective>

<execution_context>
@/Users/rui/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rui/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-ui---hud/07-CONTEXT.md
@.planning/phases/07-ui---hud/07-RESEARCH.md

# Existing UI patterns to follow:
@Berzerk/Source/UI/HealthBar.cs
@Berzerk/Source/UI/DamageVignette.cs
@Berzerk/Source/UI/GameOverScreen.cs
@Berzerk/Source/Combat/AmmoSystem.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ScoreSystem and HUD display elements</name>
  <files>
    Berzerk/Source/Combat/ScoreSystem.cs
    Berzerk/Source/UI/AmmoCounter.cs
    Berzerk/Source/UI/ScoreCounter.cs
    Berzerk/Source/UI/PickupNotification.cs
  </files>
  <action>
Create four new files following established project patterns:

**ScoreSystem.cs** (in Berzerk/Source/Combat/):
- Namespace: `Berzerk.Source.Combat`
- Properties: `CurrentScore` (int, readonly), `PointsPerEnemy` (const int, 50)
- Methods: `AddEnemyKill()` (adds PointsPerEnemy to CurrentScore, fires OnScoreChanged), `Reset()` (sets to 0, fires OnScoreChanged)
- Event: `event Action<int>? OnScoreChanged` — fires with new score value
- Pattern: Similar to HealthSystem's event-based design

**AmmoCounter.cs** (in Berzerk/Source/UI/):
- Namespace: `Berzerk.UI`
- LoadContent: takes `ContentManager content`, loads SpriteFont "Font"
- Draw: takes `SpriteBatch spriteBatch, int currentMag, int reserveAmmo, Viewport viewport`
- Display format: `"{currentMag} / {reserveAmmo}"` text
- Position: top-right corner (viewport.Width - textSize.X - 20, 20) — per CONTEXT "classic corners layout, ammo top-right"
- Color: `Color.White` normally. Per CONTEXT "flash ammo counter when low (<10 rounds)": when `currentMag < 10`, use sinusoidal pulse on alpha: `float flash = (float)(0.5 + 0.5 * Math.Sin(totalSeconds * 8.0))` to modulate between Color.Red and Color.White using Color.Lerp. Track `_totalGameTime` via an Update(float deltaTime) method that accumulates time.
- Keep it simple: no pixel texture needed, just text

**ScoreCounter.cs** (in Berzerk/Source/UI/):
- Namespace: `Berzerk.UI`
- LoadContent: takes `ContentManager content`, loads SpriteFont "Font"
- Draw: takes `SpriteBatch spriteBatch, int score, Viewport viewport`
- Display format: `"Score: {score}"`
- Position: center-top (viewport.Width / 2f - textSize.X / 2f, 20) — per CONTEXT "score center-top"
- Color: `Color.White` always — per CONTEXT "silent update to counter only"

**PickupNotification.cs** (in Berzerk/Source/UI/):
- Namespace: `Berzerk.UI`
- Inner class: `Notification { string Text; float TimeRemaining; Vector2 Position; }`
- Field: `List<Notification> _activeNotifications`
- Constants: `Duration = 2.0f`, `FadeTime = 0.5f`, `BaseY = 100`, `StackOffset = 35`
- LoadContent: takes `ContentManager content`, loads SpriteFont "Font"
- Show(string text, Viewport viewport): creates notification centered horizontally at BaseY + (count * StackOffset), adds to list. Text format examples: "+10 Ammo", "+20 Health"
- Update(float deltaTime): decrements TimeRemaining, removes expired notifications (iterate backwards for safe removal)
- Draw(SpriteBatch spriteBatch): draws each active notification. Alpha = 1.0 normally, fades linearly to 0 in last FadeTime seconds (`alpha = timeRemaining / FadeTime` when timeRemaining < FadeTime). Color: `Color.White * alpha`

All classes should use consistent code style with the existing UI files (XML doc comments, same namespace patterns).
  </action>
  <verify>
Run `dotnet build Berzerk/Berzerk.csproj` — must compile with no errors. Verify all four files exist and contain expected public APIs.
  </verify>
  <done>
ScoreSystem tracks score with event. AmmoCounter renders ammo text at top-right with low-ammo flash. ScoreCounter renders score text at top-center. PickupNotification manages timed popup queue with fade-out. All compile cleanly.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build Berzerk/Berzerk.csproj` passes with no errors
2. All four files exist under expected paths
3. ScoreSystem has CurrentScore property, AddEnemyKill(), Reset(), OnScoreChanged event
4. AmmoCounter has LoadContent, Draw with viewport-relative positioning at top-right
5. ScoreCounter has LoadContent, Draw with centered positioning at top
6. PickupNotification has LoadContent, Show, Update, Draw with fade-out logic
</verification>

<success_criteria>
- Four new source files created and compiling
- Each follows established project patterns (SpriteFont loading, Viewport-relative positioning, exponential/linear decay)
- AmmoCounter implements low-ammo flash per CONTEXT (<10 rounds)
- PickupNotification implements timed fade-out queue
- No changes to existing files (pure additions)
</success_criteria>

<output>
After completion, create `.planning/phases/07-ui---hud/07-01-SUMMARY.md`
</output>
