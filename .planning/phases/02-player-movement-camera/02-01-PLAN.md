---
phase: 02-player-movement-camera
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Berzerk/Source/Input/InputManager.cs
  - Berzerk/Source/Core/Transform.cs
autonomous: true

must_haves:
  truths:
    - "InputManager tracks scroll wheel delta between frames"
    - "InputManager detects right mouse button held state"
    - "Transform stores position and rotation as Quaternion"
  artifacts:
    - path: "Berzerk/Source/Input/InputManager.cs"
      provides: "ScrollWheelDelta and IsRightMouseHeld"
      contains: "ScrollWheelDelta"
    - path: "Berzerk/Source/Core/Transform.cs"
      provides: "Position (Vector3) and Rotation (Quaternion) component"
      min_lines: 20
  key_links:
    - from: "InputManager"
      to: "MouseState.ScrollWheelValue"
      via: "delta calculation between frames"
      pattern: "_currentMouse\\.ScrollWheelValue.*_previousMouse\\.ScrollWheelValue"
---

<objective>
Extend InputManager with scroll wheel and right-mouse-held detection, and create Transform component for shared position/rotation data.

Purpose: Foundation for player movement (needs Transform) and camera zoom/orbit (needs scroll wheel and right-click)
Output: Extended InputManager.cs with new input methods, new Transform.cs component
</objective>

<execution_context>
@/Users/rui/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rui/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-player-movement-camera/02-CONTEXT.md
@.planning/phases/02-player-movement-camera/02-RESEARCH.md

# Existing InputManager implementation
@Berzerk/Source/Input/InputManager.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend InputManager with scroll wheel and right-mouse tracking</name>
  <files>Berzerk/Source/Input/InputManager.cs</files>
  <action>
Add to InputManager class:

1. **ScrollWheelDelta property** (int):
   - Calculate delta between current and previous ScrollWheelValue
   - CRITICAL: ScrollWheelValue is CUMULATIVE (total since app start), NOT per-frame
   - Formula: `_currentMouse.ScrollWheelValue - _previousMouse.ScrollWheelValue`
   - Positive = scroll up (zoom in), Negative = scroll down (zoom out)

2. **IsRightMouseHeld() method** (bool):
   - Returns true while right mouse button is pressed (for camera orbit)
   - Use: `_currentMouse.RightButton == ButtonState.Pressed`
   - Different from existing IsRightMousePressed (edge detection vs continuous)

3. **IsLeftMouseHeld() method** (bool) for consistency:
   - Returns true while left mouse button is pressed
   - Use: `_currentMouse.LeftButton == ButtonState.Pressed`

Keep existing methods intact. Add XML documentation comments matching existing style.
  </action>
  <verify>
Build succeeds: `dotnet build Berzerk/Berzerk.csproj`
InputManager.cs contains ScrollWheelDelta, IsRightMouseHeld, IsLeftMouseHeld
  </verify>
  <done>
InputManager provides scroll wheel delta (int) and mouse button held states (bool) for camera zoom and orbit control
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Transform component</name>
  <files>Berzerk/Source/Core/Transform.cs</files>
  <action>
Create new directory `Berzerk/Source/Core/` and Transform.cs:

```csharp
namespace Berzerk.Core;

/// <summary>
/// Represents position and rotation of an entity in 3D space.
/// Uses Quaternion for rotation to avoid gimbal lock.
/// </summary>
public class Transform
{
    public Vector3 Position { get; set; } = Vector3.Zero;
    public Quaternion Rotation { get; set; } = Quaternion.Identity;

    /// <summary>
    /// Forward direction vector based on current rotation.
    /// </summary>
    public Vector3 Forward => Vector3.Transform(Vector3.Forward, Rotation);

    /// <summary>
    /// Right direction vector based on current rotation.
    /// </summary>
    public Vector3 Right => Vector3.Transform(Vector3.Right, Rotation);

    /// <summary>
    /// Up direction vector based on current rotation.
    /// </summary>
    public Vector3 Up => Vector3.Transform(Vector3.Up, Rotation);

    /// <summary>
    /// Creates world matrix from position and rotation.
    /// </summary>
    public Matrix WorldMatrix => Matrix.CreateFromQuaternion(Rotation) * Matrix.CreateTranslation(Position);
}
```

Include required usings: Microsoft.Xna.Framework

NOTE: MonoGame Vector3.Forward is (0, 0, -1) - standard OpenGL convention.
  </action>
  <verify>
Build succeeds: `dotnet build Berzerk/Berzerk.csproj`
Transform.cs exists in Berzerk/Source/Core/
  </verify>
  <done>
Transform component provides Position (Vector3), Rotation (Quaternion), derived direction vectors (Forward/Right/Up), and WorldMatrix for rendering
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. `dotnet build Berzerk/Berzerk.csproj` succeeds
2. InputManager has ScrollWheelDelta, IsRightMouseHeld, IsLeftMouseHeld
3. Transform.cs compiles with all properties/methods
4. No compilation warnings related to new code
</verification>

<success_criteria>
- InputManager extended without breaking existing functionality
- Transform component ready for PlayerController and ThirdPersonCamera usage
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/02-player-movement-camera/02-01-SUMMARY.md`
</output>
