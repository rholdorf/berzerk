---
phase: 05-enemy-ai-combat
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - Berzerk/Source/Enemies/ExplosionEffect.cs
  - Berzerk/Source/Enemies/EnemyRenderer.cs
autonomous: true

must_haves:
  truths:
    - "Explosion effect expands and fades when enemy dies"
    - "Enemy models render with correct orientation and scale"
    - "Enemy animations play based on current state"
    - "Health pickups render as green bobbing items"
  artifacts:
    - path: "Berzerk/Source/Enemies/ExplosionEffect.cs"
      provides: "Pooled visual effect for enemy death"
      contains: "GetRadius"
    - path: "Berzerk/Source/Enemies/EnemyRenderer.cs"
      provides: "Enemy and effect rendering"
      contains: "DrawEnemies"
  key_links:
    - from: "EnemyRenderer"
      to: "ExplosionEffect"
      via: "effect rendering"
      pattern: "DrawExplosions"
    - from: "EnemyRenderer"
      to: "EnemyController"
      via: "model rendering"
      pattern: "DrawEnemies"
---

<objective>
Create visual components for enemies: explosion death effect and renderer for enemies/effects.

Purpose: Provide visual feedback for enemy destruction and render enemies with correct Mixamo model orientation. Explosion effect gives satisfying destruction feedback per CONTEXT.

Output: ExplosionEffect class and EnemyRenderer ready for game integration.
</objective>

<execution_context>
@/Users/rui/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rui/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-enemy-ai-combat/05-CONTEXT.md
@.planning/phases/05-enemy-ai-combat/05-RESEARCH.md
@.planning/phases/05-enemy-ai-combat/05-01-SUMMARY.md

# Existing visual patterns
@Berzerk/Source/Combat/ImpactEffect.cs
@Berzerk/Source/Combat/ProjectileRenderer.cs
@Berzerk/Source/Graphics/AnimatedModel.cs
@Berzerk/Source/Graphics/DebugRenderer.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create explosion effect for enemy death</name>
  <files>Berzerk/Source/Enemies/ExplosionEffect.cs</files>
  <action>
Create ExplosionEffect following ImpactEffect pattern (per RESEARCH code example):

**Properties:**
- `Vector3 Position`
- `bool IsActive`

**Constants (per CONTEXT: flash and explode, simple expanding sphere):**
- `DURATION = 0.3f` seconds
- `MAX_RADIUS = 2f` units

**Timer:**
- `_timer` float tracks elapsed time

**Methods:**
- `Activate(Vector3 position)` - reset timer, set active, store position
- `Update(float deltaTime)` - advance timer, deactivate when complete
- `GetRadius()` - expand over first half (0 to MAX), shrink over second half (MAX to 0)
- `GetAlpha()` - linear fade from 1 to 0 over duration
- `GetColor()` - orange color (1.0, 0.8, 0.3) * alpha (per 03-02 impact effect decision)

**Pooling support:**
- Simple activation/deactivation pattern for object pooling

Use `namespace Berzerk.Source.Enemies;`
  </action>
  <verify>
File compiles. Radius calculation expands then shrinks correctly.
  </verify>
  <done>
ExplosionEffect provides satisfying expand-shrink-fade visual for enemy death.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create enemy renderer for models and effects</name>
  <files>Berzerk/Source/Enemies/EnemyRenderer.cs</files>
  <action>
Create EnemyRenderer for drawing enemies, explosions, and health pickups:

**Constructor:**
- Accept GraphicsDevice
- Create sphere mesh for explosions (reuse ProjectileRenderer pattern: 8-segment UV sphere)
- Create BasicEffect for explosion rendering

**Enemy Model Rendering:**
Note: For Phase 5 we'll use placeholder cube rendering like DebugRenderer.DrawTargets.
Robot Mixamo models will be loaded in Plan 04 integration. This keeps the renderer ready.

- `DrawEnemies(IReadOnlyList<EnemyController> enemies, Matrix view, Matrix projection)`
- Draw each active enemy as colored cube (red for Chase, orange for Attack, gray for Dying)
- Use DebugRenderer pattern for drawing cubes
- Apply position from enemy.Transform.Position
- Size: 1 unit cube

**Explosion Rendering:**
- `DrawExplosions(IReadOnlyList<ExplosionEffect> effects, Matrix view, Matrix projection)`
- Draw sphere at effect position with effect.GetRadius() scale
- Use effect.GetColor() for emissive color (no lighting)
- BasicEffect with emissive color, no texture

**Health Pickup Rendering:**
- `DrawHealthPickups(IReadOnlyList<HealthPickup> pickups, Matrix view, Matrix projection)`
- Draw green sphere at pickup.GetDisplayPosition()
- Size: 0.3f radius (same as ammo pickup rendering in DebugRenderer)

**Sphere mesh creation:**
- Private helper to create sphere vertices/indices
- 8 segments latitude/longitude (matches ProjectileRenderer)
- Store in VertexBuffer/IndexBuffer

Use `namespace Berzerk.Source.Enemies;`
  </action>
  <verify>
File compiles. Sphere mesh creation works.
  </verify>
  <done>
EnemyRenderer draws placeholder cubes for enemies, spheres for explosions, and green spheres for health pickups.
  </done>
</task>

</tasks>

<verification>
1. Both files compile: `dotnet build Berzerk/Berzerk.csproj`
2. ExplosionEffect.GetRadius returns values 0 -> 2 -> 0 over duration
3. ExplosionEffect.GetColor returns orange fading to transparent
4. EnemyRenderer has DrawEnemies, DrawExplosions, DrawHealthPickups methods
5. Sphere mesh creation matches existing ProjectileRenderer pattern
</verification>

<success_criteria>
- Explosion effect provides visual feedback for enemy death
- Enemy renderer can draw all enemy-related visuals
- Health pickups render distinctly green
- Pattern follows existing rendering infrastructure
</success_criteria>

<output>
After completion, create `.planning/phases/05-enemy-ai-combat/05-03-SUMMARY.md`
</output>
